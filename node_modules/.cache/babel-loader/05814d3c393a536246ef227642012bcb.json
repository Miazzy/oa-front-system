{"remainingRequest":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/thread-loader/dist/cjs.js!/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/babel-loader/lib/index.js!/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/components/jeecgbiz/modal/JSelectUserByDepModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/components/jeecgbiz/modal/JSelectUserByDepModal.vue","mtime":1571018558901},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":1565525385854},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/thread-loader/dist/cjs.js","mtime":1565525386522},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/babel-loader/lib/index.js","mtime":1565533683804},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":1565525385854},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js","mtime":1571018827562}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { filterObj } from '@/utils/util';\nimport { queryDepartTreeList, getUserList, queryUserByDepId as _queryUserByDepId, queryUserRoleMap as _queryUserRoleMap } from '@/api/api';\nexport default {\n  name: 'JSelectUserByDepModal',\n  components: {},\n  props: ['modalWidth'],\n  data: function data() {\n    return {\n      queryParam: {\n        username: \"\"\n      },\n      columns: [{\n        title: '用户账号',\n        align: 'center',\n        dataIndex: 'username'\n      }, {\n        title: '真实姓名',\n        align: 'center',\n        dataIndex: 'realname'\n      }, {\n        title: '角色名称',\n        align: 'center',\n        dataIndex: 'roleName'\n      }, {\n        title: '性别',\n        align: 'center',\n        dataIndex: 'sex',\n        customRender: function customRender(text) {\n          if (text === 1) {\n            return '男';\n          } else if (text === 2) {\n            return '女';\n          } else {\n            return text;\n          }\n        }\n      }, {\n        title: '手机号码',\n        align: 'center',\n        dataIndex: 'phone'\n      }, {\n        title: '邮箱',\n        align: 'center',\n        dataIndex: 'email'\n      }],\n      scrollTrigger: {},\n      dataSource: [],\n      selectedKeys: [],\n      userNameArr: [],\n      departName: '',\n      userRolesMap: {},\n      title: '根据部门选择用户',\n      ipagination: {\n        current: 1,\n        pageSize: 10,\n        pageSizeOptions: ['10', '20', '30'],\n        showTotal: function showTotal(total, range) {\n          return range[0] + '-' + range[1] + ' 共' + total + '条';\n        },\n        showQuickJumper: true,\n        showSizeChanger: true,\n        total: 0\n      },\n      isorter: {\n        column: 'createTime',\n        order: 'desc'\n      },\n      selectedRowKeys: [],\n      selectedRows: [],\n      departTree: [],\n      visible: false,\n      form: this.$form.createForm(this)\n    };\n  },\n  created: function created() {\n    // 该方法触发屏幕自适应\n    this.resetScreenSize();\n    this.queryUserRoleMap();\n  },\n  methods: {\n    loadData: function loadData(arg) {\n      var _this = this;\n\n      if (arg === 1) {\n        this.ipagination.current = 1;\n      }\n\n      var params = this.getQueryParams(); //查询条件\n\n      getUserList(params).then(function (res) {\n        if (res.success) {\n          _this.dataSource = res.result.records;\n\n          _this.assignRoleName(_this.dataSource);\n\n          _this.ipagination.total = res.result.total;\n        }\n      });\n    },\n    queryUserRoleMap: function queryUserRoleMap() {\n      var _this2 = this;\n\n      _queryUserRoleMap().then(function (res) {\n        if (res.success) {\n          _this2.userRolesMap = res.result;\n\n          _this2.loadData();\n        }\n      });\n    },\n    // 触发屏幕自适应\n    resetScreenSize: function resetScreenSize() {\n      var screenWidth = document.body.clientWidth;\n\n      if (screenWidth < 500) {\n        this.scrollTrigger = {\n          x: 800\n        };\n      } else {\n        this.scrollTrigger = {};\n      }\n    },\n    showModal: function showModal() {\n      this.visible = true;\n      this.assignRoleName(this.dataSource);\n      this.queryDepartTree();\n      this.form.resetFields();\n    },\n    getQueryParams: function getQueryParams() {\n      var param = Object.assign({}, this.queryParam, this.isorter);\n      param.field = this.getQueryField();\n      param.pageNo = this.ipagination.current;\n      param.pageSize = this.ipagination.pageSize;\n      return filterObj(param);\n    },\n    getQueryField: function getQueryField() {\n      var str = 'id,';\n\n      for (var a = 0; a < this.columns.length; a++) {\n        str += ',' + this.columns[a].dataIndex;\n      }\n\n      return str;\n    },\n    searchReset: function searchReset(num) {\n      var that = this;\n\n      if (num !== 0) {\n        that.queryParam = {};\n        that.loadData(1);\n      }\n\n      that.selectedRowKeys = [];\n      that.userNameArr = [];\n      that.selectedKeys = [];\n    },\n    close: function close() {\n      this.searchReset(0);\n      this.visible = false;\n    },\n    handleTableChange: function handleTableChange(pagination, filters, sorter) {\n      //TODO 筛选\n      if (Object.keys(sorter).length > 0) {\n        this.isorter.column = sorter.field;\n        this.isorter.order = 'ascend' === sorter.order ? 'asc' : 'desc';\n      }\n\n      this.ipagination = pagination;\n      this.loadData();\n    },\n    handleSubmit: function handleSubmit() {\n      var that = this;\n\n      for (var i = 0, len = this.selectedRowKeys.length; i < len; i++) {\n        this.getUserNames(this.selectedRowKeys[i]);\n      }\n\n      that.$emit('ok', that.userNameArr.join(','));\n      that.close();\n    },\n    // 遍历匹配,获取用户真实姓名\n    getUserNames: function getUserNames(rowId) {\n      var dataSource = this.dataSource;\n\n      for (var i = 0, len = dataSource.length; i < len; i++) {\n        if (rowId === dataSource[i].id) {\n          this.userNameArr.push(dataSource[i].realname);\n        }\n      }\n    },\n    // 点击树节点,筛选出对应的用户\n    onSelect: function onSelect(selectedKeys) {\n      if (selectedKeys[0] != null) {\n        this.queryUserByDepId(selectedKeys); // 调用方法根据选选择的id查询用户信息\n\n        if (this.selectedKeys[0] !== selectedKeys[0]) {\n          this.selectedKeys = [selectedKeys[0]];\n        }\n      }\n    },\n    onSelectChange: function onSelectChange(selectedRowKeys, selectionRows) {\n      this.selectedRowKeys = selectedRowKeys;\n      this.selectionRows = selectionRows;\n    },\n    onSearch: function onSearch() {\n      this.loadData(1);\n    },\n    // 根据选择的id来查询用户信息\n    queryUserByDepId: function queryUserByDepId(selectedKeys) {\n      var _this3 = this;\n\n      _queryUserByDepId({\n        id: selectedKeys.toString()\n      }).then(function (res) {\n        if (res.success) {\n          _this3.dataSource = res.result;\n          _this3.ipagination.total = res.result.length;\n\n          _this3.assignRoleName(_this3.dataSource);\n        }\n      });\n    },\n    // 传入用户id,找到匹配的角色名称\n    queryUserRole: function queryUserRole(userId) {\n      var map = this.userRolesMap;\n      var roleName = [];\n\n      for (var key in map) {\n        if (userId === key) {\n          roleName.push(map[key]);\n        }\n      }\n\n      return roleName.join(',');\n    },\n    queryDepartTree: function queryDepartTree() {\n      var _this4 = this;\n\n      queryDepartTreeList().then(function (res) {\n        if (res.success) {\n          _this4.departTree = res.result;\n        }\n      });\n    },\n    // 为角色名称赋值\n    assignRoleName: function assignRoleName(data) {\n      var userId = '';\n      var role = '';\n\n      for (var i = 0, length = data.length; i < length; i++) {\n        userId = this.dataSource[i].id;\n        role = this.queryUserRole(userId);\n        this.dataSource[i].roleName = role;\n      }\n    },\n    modalFormOk: function modalFormOk() {\n      this.loadData();\n    }\n  }\n};",null]}