{"remainingRequest":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/views/user/Step2.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/views/user/Step2.vue","mtime":1571018558939},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":1565525385854},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/thread-loader/dist/cjs.js","mtime":1565525386522},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/babel-loader/lib/index.js","mtime":1565533683804},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":1565525385854},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js","mtime":1571018827562}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { postAction } from '@/api/manage'\nexport default {\n  name: \"Step2\",\n  props:['userList'],\n  data () {\n    return {\n      form: this.$form.createForm(this),\n      loading: false,\n      accountName:this.userList.username,\n      phone:this.userList.phone,\n      dropList:\"0\",\n      captcha: \"\",\n      show:true,\n      state: {\n        time: 60,\n        smsSendBtn: false,\n      },\n      formLogin: {\n        captcha: \"\",\n        mobile: \"\",\n      },\n      validatorRules:{\n        captcha:{rule: [{ required: true, message: '请输入短信验证码!'},{validator:this.validateCaptcha}]},\n      },\n    }\n  },\n  methods: {\n    nextStep () {\n      let that = this\n      that.loading = true\n      this.form.validateFields((err, values) => {\n        console.log(values);\n        if (!err) {\n          if(that.dropList==\"0\"){\n            if(values.captcha==undefined){\n              this.cmsFailed(\"请输入短信验证码!\");\n            }else{\n              var params={}\n              params.phone=this.userList.phone;\n              params.smscode=values.captcha;\n              postAction(\"/sys/user/phoneVerification\",params).then((res)=>{\n                if(res.success){\n                console.log(res);\n                var userList={\n                  username:this.userList.username,\n                  phone:this.userList.phone,\n                  smscode:res.result\n                };\n                setTimeout(function () {\n                  that.$emit('nextStep',userList)\n                },0)\n              }else{\n                this.cmsFailed(res.message);\n              }\n            })\n\n            }\n          }\n\n\n\n      }\n    })\n    },\n    prevStep () {\n      this.$emit('prevStep',this.userList);\n    },\n    getCaptcha (e) {\n      e.preventDefault();\n      let that = this;\n        this.state.smsSendBtn = true;\n        let interval = window.setInterval(() => {\n            if (that.state.time-- <= 0) {\n          that.state.time = 60;\n          that.state.smsSendBtn = false;\n          window.clearInterval(interval);\n        }\n      }, 1000);\n\n      const hide = this.$message.loading('验证码发送中..', 0);\n      let smsParams = {\n        mobile: this.userList.phone,\n        smsmode: \"2\"\n      };\n      postAction(\"/sys/sms\", smsParams).then(res => {\n        if(!res.success ){\n        setTimeout(hide, 1);\n        this.cmsFailed(res.message);\n      }\n      setTimeout(hide, 500);\n    })\n    },\n    cmsFailed(err){\n      this.$notification[ 'error' ]({\n        message: \"验证错误\",\n        description:err,\n        duration: 4,\n      });\n    },\n    handleChangeSelect(value){\n      var that=this;\n      console.log(value);\n    if(value==0){\n      that.dropList=\"0\";\n      that.show=true;\n    }else{\n      that.dropList=\"1\";\n      that.show=false;\n    }\n    },\n  }\n\n}\n",null]}