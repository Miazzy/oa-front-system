{"remainingRequest":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/views/system/DepartList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/views/system/DepartList.vue","mtime":1571018558931},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":1565525385854},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/babel-loader/lib/index.js","mtime":1565533683804},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":1565525385854},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js","mtime":1571018827562}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport DepartModal from './modules/DepartModal'\nimport pick from 'lodash.pick'\nimport {queryDepartTreeList, searchByKeywords, deleteByDepartId} from '@/api/api'\nimport {httpAction, deleteAction} from '@/api/manage'\nimport {JeecgListMixin} from '@/mixins/JeecgListMixin'\n// 表头\nconst columns = [\n  {\n    title: '机构名称',\n    dataIndex: 'departName'\n  },\n  {\n    title: '机构类型',\n    align: 'center',\n    dataIndex: 'orgType'\n  },\n  {\n    title: '机构编码',\n    dataIndex: 'orgCode',\n  },\n  {\n    title: '手机号',\n    dataIndex: 'mobile'\n  },\n  {\n    title: '传真',\n    dataIndex: 'fax'\n  },\n  {\n    title: '地址',\n    dataIndex: 'address'\n  },\n  {\n    title: '排序',\n    align: 'center',\n    dataIndex: 'departOrder'\n  },\n  {\n    title: '操作',\n    align: 'center',\n    dataIndex: 'action',\n    scopedSlots: {customRender: 'action'}\n  }\n]\nexport default {\n  name: 'DepartList',\n  mixins: [JeecgListMixin],\n  components: {\n    DepartModal\n  },\n  data() {\n    return {\n      iExpandedKeys: [],\n      loading: false,\n      autoExpandParent: true,\n      currFlowId: '',\n      currFlowName: '',\n      disable: true,\n      treeData: [],\n      visible: false,\n      departTree: [],\n      rightClickSelectedKey: '',\n      hiding: true,\n      model: {},\n      dropTrigger: '',\n      depart: {},\n      columns: columns,\n      disableSubmit: false,\n      checkedKeys: [],\n      selectedKeys: [],\n      autoIncr: 1,\n      currSelected: {},\n      form: this.$form.createForm(this),\n      labelCol: {\n        xs: {span: 24},\n        sm: {span: 5}\n      },\n      wrapperCol: {\n        xs: {span: 24},\n        sm: {span: 16}\n      },\n      graphDatasource: {\n        nodes: [],\n        edges: []\n      },\n      validatorRules: {\n        departName: {rules: [{required: true, message: '请输入机构/部门名称!'}]},\n        orgCode: {rules: [{required: true, message: '请输入机构编码!'}]},\n        mobile: {rules: [{validator: this.validateMobile}]}\n      },\n      url: {\n        delete: '/sys/sysDepart/delete',\n        edit: '/sys/sysDepart/edit',\n        deleteBatch: '/sys/sysDepart/deleteBatch',\n        exportXlsUrl: \"sys/sysDepart/exportXls\",\n        importExcelUrl: \"sys/sysDepart/importExcel\",\n      },\n    }\n  },\n  computed: {\n    importExcelUrl: function () {\n      return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\n    }\n  },\n  methods: {\n    loadData() {\n      this.refresh();\n    },\n    loadTree() {\n      var that = this\n      that.treeData = []\n      that.departTree = []\n      queryDepartTreeList().then((res) => {\n        if (res.success) {\n          for (let i = 0; i < res.result.length; i++) {\n            let temp = res.result[i]\n            that.treeData.push(temp)\n            that.departTree.push(temp)\n            that.setThisExpandedKeys(temp)\n            console.log(temp.id)\n          }\n          this.loading = false\n        }\n      })\n    },\n    setThisExpandedKeys(node) {\n      if (node.children && node.children.length > 0) {\n        this.iExpandedKeys.push(node.key)\n        for (let a = 0; a < node.children.length; a++) {\n          this.setThisExpandedKeys(node.children[a])\n        }\n      }\n    },\n    refresh() {\n      this.loading = true\n      this.loadTree()\n    },\n    // 右键操作方法\n    rightHandle(node) {\n      this.dropTrigger = 'contextmenu'\n      console.log(node.node.eventKey)\n      this.rightClickSelectedKey = node.node.eventKey\n    },\n    onExpand(expandedKeys) {\n      console.log('onExpand', expandedKeys)\n      // if not set autoExpandParent to false, if children expanded, parent can not collapse.\n      // or, you can remove all expanded children keys.\n      this.iExpandedKeys = expandedKeys\n      this.autoExpandParent = false\n    },\n    backFlowList() {\n      this.$router.back(-1)\n    },\n    // 右键点击下拉框改变事件\n    dropStatus(visible) {\n      if (visible == false) {\n        this.dropTrigger = ''\n      }\n    },\n    // 右键店家下拉关闭下拉框\n    closeDrop() {\n      this.dropTrigger = ''\n    },\n    addRootNode() {\n      this.$refs.nodeModal.add(this.currFlowId, '')\n    },\n    batchDel: function () {\n      console.log(this.checkedKeys)\n      if (this.checkedKeys.length <= 0) {\n        this.$message.warning('请选择一条记录！')\n      } else {\n        var ids = ''\n        for (var a = 0; a < this.checkedKeys.length; a++) {\n          ids += this.checkedKeys[a] + ','\n        }\n        var that = this\n        this.$confirm({\n          title: '确认删除',\n          content: '确定要删除所选中的 ' + this.checkedKeys.length + ' 条数据，以及子节点数据吗?',\n          onOk: function () {\n            deleteAction(that.url.deleteBatch, {ids: ids}).then((res) => {\n              if (res.success) {\n                that.$message.success(res.message)\n                that.loadTree()\n                that.onClearSelected()\n              } else {\n                that.$message.warning(res.message)\n              }\n            })\n          }\n        })\n      }\n    },\n    onSearch(value) {\n      let that = this\n      if (value) {\n        searchByKeywords({keyWord: value}).then((res) => {\n          if (res.success) {\n            that.departTree = []\n            for (let i = 0; i < res.result.length; i++) {\n              let temp = res.result[i]\n              that.departTree.push(temp)\n            }\n          } else {\n            that.$message.warning(res.message)\n          }\n        })\n      } else {\n        that.loadTree()\n      }\n\n    },\n    nodeModalOk() {\n      this.loadTree()\n    },\n    nodeModalClose() {\n    },\n    hide() {\n      console.log(111)\n      this.visible = false\n    },\n    onCheck(checkedKeys, info) {\n      console.log('onCheck', checkedKeys, info)\n      this.hiding = false\n      this.checkedKeys = checkedKeys.checked\n    },\n    onSelect(selectedKeys, e) {\n      console.log('selected', selectedKeys, e)\n      this.hiding = false\n      let record = e.node.dataRef\n      console.log('onSelect-record', record)\n      this.currSelected = Object.assign({}, record)\n      this.model = this.currSelected\n      this.selectedKeys = [record.key]\n      this.model.parentId = record.parentId\n      this.setValuesToForm(record)\n\n\n    },\n    // 触发onSelect事件时,为部门树右侧的form表单赋值\n    setValuesToForm(record) {\n      this.form.getFieldDecorator('fax', {initialValue: ''})\n      this.form.setFieldsValue(pick(record, 'departName', 'orgCode', 'departOrder', 'mobile', 'fax', 'address', 'memo'))\n    },\n    getCurrSelectedTitle() {\n      return !this.currSelected.title ? '' : this.currSelected.title\n    },\n    onClearSelected() {\n      this.hiding = true\n      this.checkedKeys = []\n      this.currSelected = {}\n      this.form.resetFields()\n      this.selectedKeys = []\n    },\n    handleNodeTypeChange(val) {\n      this.currSelected.nodeType = val\n    },\n    notifyTriggerTypeChange(value) {\n      this.currSelected.notifyTriggerType = value\n    },\n    receiptTriggerTypeChange(value) {\n      this.currSelected.receiptTriggerType = value\n    },\n    submitCurrForm() {\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          if (!this.currSelected.id) {\n            this.$message.warning('请点击选择要修改部门!')\n            return\n          }\n\n          let formData = Object.assign(this.currSelected, values)\n          console.log('Received values of form: ', formData)\n          httpAction(this.url.edit, formData, 'put').then((res) => {\n            if (res.success) {\n              this.$message.success('保存成功!')\n              this.loadTree()\n            } else {\n              this.$message.error(res.message)\n            }\n          })\n        }\n      })\n    },\n    emptyCurrForm() {\n      this.form.resetFields()\n    },\n    nodeSettingFormSubmit() {\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          console.log('Received values of form: ', values)\n        }\n      })\n    },\n    openSelect() {\n      this.$refs.sysDirectiveModal.show()\n    },\n    handleAdd(num) {\n      if (num == 1) {\n        this.$refs.departModal.add()\n        this.$refs.departModal.title = '新增'\n      } else if (num == 2) {\n        let key = this.currSelected.key\n        if (!key) {\n          this.$message.warning('请先选中一条记录!')\n          return false\n        }\n        this.$refs.departModal.add(this.selectedKeys)\n        this.$refs.departModal.title = '新增'\n      } else {\n        this.$refs.departModal.add(this.rightClickSelectedKey)\n        this.$refs.departModal.title = '新增'\n      }\n    },\n    handleDelete() {\n      deleteByDepartId({id: this.rightClickSelectedKey}).then((resp) => {\n        if (resp.success) {\n          this.$message.success('删除成功!')\n          this.loadTree()\n        } else {\n          this.$message.warning('删除失败!')\n        }\n      })\n    },\n    selectDirectiveOk(record) {\n      console.log('选中指令数据', record)\n      this.nodeSettingForm.setFieldsValue({directiveCode: record.directiveCode})\n      this.currSelected.sysCode = record.sysCode\n    },\n    getFlowGraphData(node) {\n      this.graphDatasource.nodes.push({\n        id: node.id,\n        text: node.flowNodeName\n      })\n      if (node.children.length > 0) {\n        for (let a = 0; a < node.children.length; a++) {\n          let temp = node.children[a]\n          this.graphDatasource.edges.push({\n            source: node.id,\n            target: temp.id\n          })\n          this.getFlowGraphData(temp)\n        }\n      }\n    },\n  },\n  created() {\n    this.currFlowId = this.$route.params.id\n    this.currFlowName = this.$route.params.name\n    // this.loadTree()\n  },\n\n}\n",{"version":3,"sources":["DepartList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"DepartList.vue","sourceRoot":"src/views/system","sourcesContent":["<template xmlns:background-color=\"http://www.w3.org/1999/xhtml\">\n  <a-row :gutter=\"10\">\n    <a-col :md=\"12\" :sm=\"24\">\n      <a-card :bordered=\"false\">\n\n        <!-- 按钮操作区域 -->\n        <a-row style=\"margin-left: 14px\">\n          <a-button @click=\"handleAdd(2)\" type=\"primary\">添加子部门</a-button>\n          <a-button @click=\"handleAdd(1)\" type=\"primary\">添加一级部门</a-button>\n          <a-button type=\"primary\" icon=\"download\" @click=\"handleExportXls('部门信息')\">导出</a-button>\n          <a-upload name=\"file\" :showUploadList=\"false\" :multiple=\"false\" :headers=\"tokenHeader\" :action=\"importExcelUrl\" @change=\"handleImportExcel\">\n            <a-button type=\"primary\" icon=\"import\">导入</a-button>\n          </a-upload>\n          <a-button title=\"删除多条数据\" @click=\"batchDel\" type=\"default\">批量删除</a-button>\n          <!--<a-button @click=\"refresh\" type=\"default\" icon=\"reload\" :loading=\"loading\">刷新</a-button>-->\n        </a-row>\n        <div style=\"background: #fff;padding-left:16px;height: 100%; margin-top: 5px\">\n          <a-alert type=\"info\" :showIcon=\"true\">\n            <div slot=\"message\">\n              当前选择：\n              <a v-if=\"this.currSelected.title\">{{ getCurrSelectedTitle() }}</a>\n              <a v-if=\"this.currSelected.title\" style=\"margin-left: 10px\" @click=\"onClearSelected\">取消选择</a>\n            </div>\n          </a-alert>\n          <a-input-search @search=\"onSearch\" style=\"width:100%;margin-top: 10px\" placeholder=\"请输入部门名称\"/>\n          <!-- 树-->\n          <a-col :md=\"10\" :sm=\"24\">\n            <template>\n              <a-dropdown :trigger=\"[this.dropTrigger]\" @visibleChange=\"dropStatus\">\n               <span style=\"user-select: none\">\n            <a-tree\n              checkable\n              multiple\n              @select=\"onSelect\"\n              @check=\"onCheck\"\n              @rightClick=\"rightHandle\"\n              :selectedKeys=\"selectedKeys\"\n              :checkedKeys=\"checkedKeys\"\n              :treeData=\"departTree\"\n              :checkStrictly=\"true\"\n              :expandedKeys=\"iExpandedKeys\"\n              :autoExpandParent=\"autoExpandParent\"\n              @expand=\"onExpand\"/>\n                </span>\n                <!--新增右键点击事件,和增加添加和删除功能-->\n                <a-menu slot=\"overlay\">\n                  <a-menu-item @click=\"handleAdd(3)\" key=\"1\">添加</a-menu-item>\n                  <a-menu-item @click=\"handleDelete\" key=\"2\">删除</a-menu-item>\n                  <a-menu-item @click=\"closeDrop\" key=\"3\">取消</a-menu-item>\n                </a-menu>\n              </a-dropdown>\n            </template>\n          </a-col>\n        </div>\n      </a-card>\n    </a-col>\n    <a-col :md=\"12\" :sm=\"24\">\n      <a-card :bordered=\"false\">\n        <a-form :form=\"form\">\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"机构名称\">\n            <a-input placeholder=\"请输入机构/部门名称\" v-decorator=\"['departName', validatorRules.departName ]\"/>\n          </a-form-item>\n          <a-form-item :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\" label=\"上级部门\">\n            <a-tree-select\n              style=\"width:100%\"\n              :dropdownStyle=\"{maxHeight:'200px',overflow:'auto'}\"\n              :treeData=\"treeData\"\n              :disabled=\"disable\"\n              v-model=\"model.parentId\"\n              placeholder=\"无\">\n            </a-tree-select>\n          </a-form-item>\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"机构编码\">\n            <a-input disabled placeholder=\"请输入机构编码\" v-decorator=\"['orgCode', validatorRules.orgCode ]\"/>\n          </a-form-item>\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"排序\">\n            <a-input-number v-decorator=\"[ 'departOrder',{'initialValue':0}]\"/>\n          </a-form-item>\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"手机号\">\n            <a-input placeholder=\"请输入手机号\" v-decorator=\"['mobile', {'initialValue':''}]\"/>\n          </a-form-item>\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"地址\">\n            <a-input placeholder=\"请输入地址\" v-decorator=\"['address', {'initialValue':''}]\"/>\n          </a-form-item>\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"备注\">\n            <a-textarea placeholder=\"请输入备注\" v-decorator=\"['memo', {'initialValue':''}]\"/>\n          </a-form-item>\n        </a-form>\n        <div class=\"anty-form-btn\">\n          <a-button @click=\"emptyCurrForm\" type=\"default\" htmlType=\"button\" icon=\"sync\">重置</a-button>\n          <a-button @click=\"submitCurrForm\" type=\"primary\" htmlType=\"button\" icon=\"form\">修改并保存</a-button>\n        </div>\n      </a-card>\n    </a-col>\n    <depart-modal ref=\"departModal\" @ok=\"loadTree\"></depart-modal>\n  </a-row>\n</template>\n<script>\n  import DepartModal from './modules/DepartModal'\n  import pick from 'lodash.pick'\n  import {queryDepartTreeList, searchByKeywords, deleteByDepartId} from '@/api/api'\n  import {httpAction, deleteAction} from '@/api/manage'\n  import {JeecgListMixin} from '@/mixins/JeecgListMixin'\n  // 表头\n  const columns = [\n    {\n      title: '机构名称',\n      dataIndex: 'departName'\n    },\n    {\n      title: '机构类型',\n      align: 'center',\n      dataIndex: 'orgType'\n    },\n    {\n      title: '机构编码',\n      dataIndex: 'orgCode',\n    },\n    {\n      title: '手机号',\n      dataIndex: 'mobile'\n    },\n    {\n      title: '传真',\n      dataIndex: 'fax'\n    },\n    {\n      title: '地址',\n      dataIndex: 'address'\n    },\n    {\n      title: '排序',\n      align: 'center',\n      dataIndex: 'departOrder'\n    },\n    {\n      title: '操作',\n      align: 'center',\n      dataIndex: 'action',\n      scopedSlots: {customRender: 'action'}\n    }\n  ]\n  export default {\n    name: 'DepartList',\n    mixins: [JeecgListMixin],\n    components: {\n      DepartModal\n    },\n    data() {\n      return {\n        iExpandedKeys: [],\n        loading: false,\n        autoExpandParent: true,\n        currFlowId: '',\n        currFlowName: '',\n        disable: true,\n        treeData: [],\n        visible: false,\n        departTree: [],\n        rightClickSelectedKey: '',\n        hiding: true,\n        model: {},\n        dropTrigger: '',\n        depart: {},\n        columns: columns,\n        disableSubmit: false,\n        checkedKeys: [],\n        selectedKeys: [],\n        autoIncr: 1,\n        currSelected: {},\n        form: this.$form.createForm(this),\n        labelCol: {\n          xs: {span: 24},\n          sm: {span: 5}\n        },\n        wrapperCol: {\n          xs: {span: 24},\n          sm: {span: 16}\n        },\n        graphDatasource: {\n          nodes: [],\n          edges: []\n        },\n        validatorRules: {\n          departName: {rules: [{required: true, message: '请输入机构/部门名称!'}]},\n          orgCode: {rules: [{required: true, message: '请输入机构编码!'}]},\n          mobile: {rules: [{validator: this.validateMobile}]}\n        },\n        url: {\n          delete: '/sys/sysDepart/delete',\n          edit: '/sys/sysDepart/edit',\n          deleteBatch: '/sys/sysDepart/deleteBatch',\n          exportXlsUrl: \"sys/sysDepart/exportXls\",\n          importExcelUrl: \"sys/sysDepart/importExcel\",\n        },\n      }\n    },\n    computed: {\n      importExcelUrl: function () {\n        return `${window._CONFIG['domianURL']}/${this.url.importExcelUrl}`;\n      }\n    },\n    methods: {\n      loadData() {\n        this.refresh();\n      },\n      loadTree() {\n        var that = this\n        that.treeData = []\n        that.departTree = []\n        queryDepartTreeList().then((res) => {\n          if (res.success) {\n            for (let i = 0; i < res.result.length; i++) {\n              let temp = res.result[i]\n              that.treeData.push(temp)\n              that.departTree.push(temp)\n              that.setThisExpandedKeys(temp)\n              console.log(temp.id)\n            }\n            this.loading = false\n          }\n        })\n      },\n      setThisExpandedKeys(node) {\n        if (node.children && node.children.length > 0) {\n          this.iExpandedKeys.push(node.key)\n          for (let a = 0; a < node.children.length; a++) {\n            this.setThisExpandedKeys(node.children[a])\n          }\n        }\n      },\n      refresh() {\n        this.loading = true\n        this.loadTree()\n      },\n      // 右键操作方法\n      rightHandle(node) {\n        this.dropTrigger = 'contextmenu'\n        console.log(node.node.eventKey)\n        this.rightClickSelectedKey = node.node.eventKey\n      },\n      onExpand(expandedKeys) {\n        console.log('onExpand', expandedKeys)\n        // if not set autoExpandParent to false, if children expanded, parent can not collapse.\n        // or, you can remove all expanded children keys.\n        this.iExpandedKeys = expandedKeys\n        this.autoExpandParent = false\n      },\n      backFlowList() {\n        this.$router.back(-1)\n      },\n      // 右键点击下拉框改变事件\n      dropStatus(visible) {\n        if (visible == false) {\n          this.dropTrigger = ''\n        }\n      },\n      // 右键店家下拉关闭下拉框\n      closeDrop() {\n        this.dropTrigger = ''\n      },\n      addRootNode() {\n        this.$refs.nodeModal.add(this.currFlowId, '')\n      },\n      batchDel: function () {\n        console.log(this.checkedKeys)\n        if (this.checkedKeys.length <= 0) {\n          this.$message.warning('请选择一条记录！')\n        } else {\n          var ids = ''\n          for (var a = 0; a < this.checkedKeys.length; a++) {\n            ids += this.checkedKeys[a] + ','\n          }\n          var that = this\n          this.$confirm({\n            title: '确认删除',\n            content: '确定要删除所选中的 ' + this.checkedKeys.length + ' 条数据，以及子节点数据吗?',\n            onOk: function () {\n              deleteAction(that.url.deleteBatch, {ids: ids}).then((res) => {\n                if (res.success) {\n                  that.$message.success(res.message)\n                  that.loadTree()\n                  that.onClearSelected()\n                } else {\n                  that.$message.warning(res.message)\n                }\n              })\n            }\n          })\n        }\n      },\n      onSearch(value) {\n        let that = this\n        if (value) {\n          searchByKeywords({keyWord: value}).then((res) => {\n            if (res.success) {\n              that.departTree = []\n              for (let i = 0; i < res.result.length; i++) {\n                let temp = res.result[i]\n                that.departTree.push(temp)\n              }\n            } else {\n              that.$message.warning(res.message)\n            }\n          })\n        } else {\n          that.loadTree()\n        }\n\n      },\n      nodeModalOk() {\n        this.loadTree()\n      },\n      nodeModalClose() {\n      },\n      hide() {\n        console.log(111)\n        this.visible = false\n      },\n      onCheck(checkedKeys, info) {\n        console.log('onCheck', checkedKeys, info)\n        this.hiding = false\n        this.checkedKeys = checkedKeys.checked\n      },\n      onSelect(selectedKeys, e) {\n        console.log('selected', selectedKeys, e)\n        this.hiding = false\n        let record = e.node.dataRef\n        console.log('onSelect-record', record)\n        this.currSelected = Object.assign({}, record)\n        this.model = this.currSelected\n        this.selectedKeys = [record.key]\n        this.model.parentId = record.parentId\n        this.setValuesToForm(record)\n\n\n      },\n      // 触发onSelect事件时,为部门树右侧的form表单赋值\n      setValuesToForm(record) {\n        this.form.getFieldDecorator('fax', {initialValue: ''})\n        this.form.setFieldsValue(pick(record, 'departName', 'orgCode', 'departOrder', 'mobile', 'fax', 'address', 'memo'))\n      },\n      getCurrSelectedTitle() {\n        return !this.currSelected.title ? '' : this.currSelected.title\n      },\n      onClearSelected() {\n        this.hiding = true\n        this.checkedKeys = []\n        this.currSelected = {}\n        this.form.resetFields()\n        this.selectedKeys = []\n      },\n      handleNodeTypeChange(val) {\n        this.currSelected.nodeType = val\n      },\n      notifyTriggerTypeChange(value) {\n        this.currSelected.notifyTriggerType = value\n      },\n      receiptTriggerTypeChange(value) {\n        this.currSelected.receiptTriggerType = value\n      },\n      submitCurrForm() {\n        this.form.validateFields((err, values) => {\n          if (!err) {\n            if (!this.currSelected.id) {\n              this.$message.warning('请点击选择要修改部门!')\n              return\n            }\n\n            let formData = Object.assign(this.currSelected, values)\n            console.log('Received values of form: ', formData)\n            httpAction(this.url.edit, formData, 'put').then((res) => {\n              if (res.success) {\n                this.$message.success('保存成功!')\n                this.loadTree()\n              } else {\n                this.$message.error(res.message)\n              }\n            })\n          }\n        })\n      },\n      emptyCurrForm() {\n        this.form.resetFields()\n      },\n      nodeSettingFormSubmit() {\n        this.form.validateFields((err, values) => {\n          if (!err) {\n            console.log('Received values of form: ', values)\n          }\n        })\n      },\n      openSelect() {\n        this.$refs.sysDirectiveModal.show()\n      },\n      handleAdd(num) {\n        if (num == 1) {\n          this.$refs.departModal.add()\n          this.$refs.departModal.title = '新增'\n        } else if (num == 2) {\n          let key = this.currSelected.key\n          if (!key) {\n            this.$message.warning('请先选中一条记录!')\n            return false\n          }\n          this.$refs.departModal.add(this.selectedKeys)\n          this.$refs.departModal.title = '新增'\n        } else {\n          this.$refs.departModal.add(this.rightClickSelectedKey)\n          this.$refs.departModal.title = '新增'\n        }\n      },\n      handleDelete() {\n        deleteByDepartId({id: this.rightClickSelectedKey}).then((resp) => {\n          if (resp.success) {\n            this.$message.success('删除成功!')\n            this.loadTree()\n          } else {\n            this.$message.warning('删除失败!')\n          }\n        })\n      },\n      selectDirectiveOk(record) {\n        console.log('选中指令数据', record)\n        this.nodeSettingForm.setFieldsValue({directiveCode: record.directiveCode})\n        this.currSelected.sysCode = record.sysCode\n      },\n      getFlowGraphData(node) {\n        this.graphDatasource.nodes.push({\n          id: node.id,\n          text: node.flowNodeName\n        })\n        if (node.children.length > 0) {\n          for (let a = 0; a < node.children.length; a++) {\n            let temp = node.children[a]\n            this.graphDatasource.edges.push({\n              source: node.id,\n              target: temp.id\n            })\n            this.getFlowGraphData(temp)\n          }\n        }\n      },\n    },\n    created() {\n      this.currFlowId = this.$route.params.id\n      this.currFlowName = this.$route.params.name\n      // this.loadTree()\n    },\n\n  }\n</script>\n<style scoped>\n  .ant-card-body .table-operator {\n    margin: 15px;\n  }\n\n  .anty-form-btn {\n    width: 100%;\n    text-align: center;\n  }\n\n  .anty-form-btn button {\n    margin: 0 5px;\n  }\n\n  .anty-node-layout .ant-layout-header {\n    padding-right: 0\n  }\n\n  .header {\n    padding: 0 8px;\n  }\n\n  .header button {\n    margin: 0 3px\n  }\n\n  .ant-modal-cust-warp {\n    height: 100%\n  }\n\n  .ant-modal-cust-warp .ant-modal-body {\n    height: calc(100% - 110px) !important;\n    overflow-y: auto\n  }\n\n  .ant-modal-cust-warp .ant-modal-content {\n    height: 90% !important;\n    overflow-y: hidden\n  }\n\n  #app .desktop {\n    height: auto !important;\n  }\n\n  /** Button按钮间距 */\n  .ant-btn {\n    margin-left: 3px\n  }\n</style>"]}]}