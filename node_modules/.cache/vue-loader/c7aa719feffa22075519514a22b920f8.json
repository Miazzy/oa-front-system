{"remainingRequest":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/views/system/modules/RoleDataruleModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/src/views/system/modules/RoleDataruleModal.vue","mtime":1571018558936},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yunwisdom/Workspace/jeecg-boot/ant-design-vue-jeecg/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ARow from 'ant-design-vue/es/grid/Row'\nimport ACol from 'ant-design-vue/es/grid/Col'\nimport { getAction,postAction } from '@/api/manage'\n\nexport default {\n  name: 'RoleDataruleModal',\n  components: { ACol, ARow },\n  data(){\n    return {\n      functionId:'',\n      roleId:'',\n      visible:false,\n      tabList: [{\n        key: '1',\n        tab: '数据规则',\n      }, {\n        key: '2',\n        tab: '按钮权限',\n      }],\n      activeTabKey: '1',\n      url:{\n        datarule:\"/sys/role/datarule\",\n      },\n      dataruleList:[],\n      dataruleChecked:[]\n    }\n  },\n  methods:{\n    loadData(){\n      getAction(`${this.url.datarule}/${this.functionId}/${this.roleId}`).then(res=>{\n        console.log(res)\n        if(res.success){\n          this.dataruleList = res.result.datarule\n          let drChecked = res.result.drChecked\n          if(drChecked){\n            this.dataruleChecked = drChecked.split(\",\")\n          }\n        }\n      })\n    },\n    saveDataruleForRole(){\n      if(!this.dataruleChecked || this.dataruleChecked.length==0){\n        this.$message.warning(\"请注意，现未勾选任何数据权限!\")\n      }\n      let params = {\n        permissionId:this.functionId,\n        roleId:this.roleId,\n        dataRuleIds:this.dataruleChecked.join(\",\")\n      }\n      console.log(\"保存数据权限\",params)\n      postAction(this.url.datarule,params).then(res=>{\n        if(res.success){\n          this.$message.success(res.message)\n        }else{\n          this.$message.error(res.message)\n        }\n      })\n    },\n    show(functionId,roleId){\n      this.onReset()\n      this.functionId = functionId\n      this.roleId = roleId\n      this.visible=true\n      this.loadData()\n    },\n    onClose(){\n      this.visible=false\n      this.onReset()\n    },\n    onTabChange (key) {\n      this.activeTabKey = key\n    },\n    onReset(){\n      this.functionId=''\n      this.roleId=''\n      this.dataruleList=[]\n      this.dataruleChecked=[]\n    }\n  }\n}\n",null]}